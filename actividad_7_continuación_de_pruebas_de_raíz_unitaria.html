<style>body {background: white}</style><?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Untitled</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="CoolUtils HTML exporter" />
<style type="text/css">
<!--
body { color: #000000; background-color: #FFFFFF; }
.python1-classname { color: #000080; font-weight: bold; }
.python1-comment { color: #808080; font-style: italic; }
.python1-commentedcode { color: #C0C0C0; font-style: italic; }
.python1-documentation { color: #CC00FF; }
.python1-float { color: #008080; }
.python1-functionname { color: #008080; font-weight: bold; }
.python1-hexadecimal { color: #008080; }
.python1-identifier { color: #000000; }
.python1-matchingbrace { color: #0000FF; font-weight: bold; }
.python1-multi-linestring { color: #808000; }
.python1-nonreservedkeyword { color: #000080; }
.python1-number { color: #008080; }
.python1-octal { color: #008080; }
.python1-reservedword { font-weight: bold; }
.python1-space { color: #C0C0C0; }
.python1-string { color: #808000; }
.python1-symbol { color: #800000; }
.python1-syntaxerror { color: #FF0000; }
.python1-systemfunctionsandvariables { font-weight: bold; }
.python1-unbalancedbrace { color: #FFFF00; }
-->
</style>
</head>
<body>
<!--StartFragment--><pre><code><span class="python1-comment"># -*- coding: utf-8 -*-
</span><span class="python1-documentation">&quot;&quot;&quot;Actividad 7 - ContinuaciГіn de Pruebas de raГ­z unitaria

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1mrpM0JD8nr9cmdOsRDnqxgXRRfBJBs07
&quot;&quot;&quot;

</span><span class="python1-comment"># LibrerГ­as necesarias
</span><span class="python1-reservedword">import</span><span class="python1-space"> </span><span class="python1-identifier">pandas</span><span class="python1-space"> </span><span class="python1-reservedword">as</span><span class="python1-space"> </span><span class="python1-identifier">pd
</span><span class="python1-reservedword">import</span><span class="python1-space"> </span><span class="python1-identifier">numpy</span><span class="python1-space"> </span><span class="python1-reservedword">as</span><span class="python1-space"> </span><span class="python1-identifier">np
</span><span class="python1-reservedword">from</span><span class="python1-space"> </span><span class="python1-identifier">google</span><span class="python1-symbol">.</span><span class="python1-identifier">colab</span><span class="python1-space"> </span><span class="python1-reservedword">import</span><span class="python1-space"> </span><span class="python1-identifier">files
</span><span class="python1-reservedword">import</span><span class="python1-space"> </span><span class="python1-identifier">statsmodels</span><span class="python1-symbol">.</span><span class="python1-identifier">api</span><span class="python1-space"> </span><span class="python1-reservedword">as</span><span class="python1-space"> </span><span class="python1-identifier">sm
</span><span class="python1-reservedword">from</span><span class="python1-space"> </span><span class="python1-identifier">statsmodels</span><span class="python1-symbol">.</span><span class="python1-identifier">tsa</span><span class="python1-symbol">.</span><span class="python1-identifier">stattools</span><span class="python1-space"> </span><span class="python1-reservedword">import</span><span class="python1-space"> </span><span class="python1-identifier">adfuller</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">kpss
</span><span class="python1-reservedword">from</span><span class="python1-space"> </span><span class="python1-identifier">statsmodels</span><span class="python1-symbol">.</span><span class="python1-identifier">graphics</span><span class="python1-symbol">.</span><span class="python1-identifier">tsaplots</span><span class="python1-space"> </span><span class="python1-reservedword">import</span><span class="python1-space"> </span><span class="python1-identifier">plot_acf</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">plot_pacf
</span><span class="python1-reservedword">from</span><span class="python1-space"> </span><span class="python1-identifier">statsmodels</span><span class="python1-symbol">.</span><span class="python1-identifier">tsa</span><span class="python1-symbol">.</span><span class="python1-identifier">arima</span><span class="python1-symbol">.</span><span class="python1-identifier">model</span><span class="python1-space"> </span><span class="python1-reservedword">import</span><span class="python1-space"> </span><span class="python1-identifier">ARIMA
</span><span class="python1-reservedword">from</span><span class="python1-space"> </span><span class="python1-identifier">statsmodels</span><span class="python1-symbol">.</span><span class="python1-identifier">tsa</span><span class="python1-symbol">.</span><span class="python1-identifier">vector_ar</span><span class="python1-symbol">.</span><span class="python1-identifier">vecm</span><span class="python1-space"> </span><span class="python1-reservedword">import</span><span class="python1-space"> </span><span class="python1-identifier">coint_johansen
</span><span class="python1-reservedword">import</span><span class="python1-space"> </span><span class="python1-identifier">matplotlib</span><span class="python1-symbol">.</span><span class="python1-identifier">pyplot</span><span class="python1-space"> </span><span class="python1-reservedword">as</span><span class="python1-space"> </span><span class="python1-identifier">plt
</span><span class="python1-reservedword">from</span><span class="python1-space"> </span><span class="python1-identifier">itertools</span><span class="python1-space"> </span><span class="python1-reservedword">import</span><span class="python1-space"> </span><span class="python1-identifier">combinations

plt</span><span class="python1-symbol">.</span><span class="python1-identifier">style</span><span class="python1-symbol">.</span><span class="python1-identifier">use</span><span class="python1-symbol">(</span><span class="python1-string">'seaborn-v0_8-whitegrid'</span><span class="python1-symbol">)

</span><span class="python1-comment"># Nombres simbГіlicos de las acciones
</span><span class="python1-identifier">tickers</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-symbol">[</span><span class="python1-string">'AAPL'</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-string">'CAT'</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-string">'SPOT'</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-string">'MCD'</span><span class="python1-symbol">]
</span><span class="python1-identifier">data</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-symbol">{}

</span><span class="python1-comment"># Subir archivos y leer automГЎticamente
</span><span class="python1-reservedword">for</span><span class="python1-space"> </span><span class="python1-identifier">ticker</span><span class="python1-space"> </span><span class="python1-reservedword">in</span><span class="python1-space"> </span><span class="python1-identifier">tickers</span><span class="python1-symbol">:
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;рџ”ј Sube el archivo de precios para: {ticker} (solo 1 columna sin encabezado 'Date')&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">uploaded</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">files</span><span class="python1-symbol">.</span><span class="python1-identifier">upload</span><span class="python1-symbol">()
</span><span class="python1-space">    </span><span class="python1-identifier">filename</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-nonreservedkeyword">list</span><span class="python1-symbol">(</span><span class="python1-identifier">uploaded</span><span class="python1-symbol">.</span><span class="python1-identifier">keys</span><span class="python1-symbol">())[</span><span class="python1-number">0</span><span class="python1-symbol">]
</span><span class="python1-space">    </span><span class="python1-identifier">df</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">pd</span><span class="python1-symbol">.</span><span class="python1-identifier">read_excel</span><span class="python1-symbol">(</span><span class="python1-identifier">filename</span><span class="python1-symbol">)

</span><span class="python1-space">    </span><span class="python1-reservedword">if</span><span class="python1-space"> </span><span class="python1-identifier">df</span><span class="python1-symbol">.</span><span class="python1-identifier">shape</span><span class="python1-symbol">[</span><span class="python1-number">1</span><span class="python1-symbol">]</span><span class="python1-space"> </span><span class="python1-symbol">!=</span><span class="python1-space"> </span><span class="python1-number">1</span><span class="python1-symbol">:
</span><span class="python1-space">        </span><span class="python1-reservedword">raise</span><span class="python1-space"> </span><span class="python1-nonreservedkeyword">ValueError</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;вљ пёЏ El archivo para {ticker} debe tener solo UNA columna con precios.&quot;</span><span class="python1-symbol">)

</span><span class="python1-space">    </span><span class="python1-identifier">data</span><span class="python1-symbol">[</span><span class="python1-identifier">ticker</span><span class="python1-symbol">]</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">df</span><span class="python1-symbol">.</span><span class="python1-identifier">iloc</span><span class="python1-symbol">[:,</span><span class="python1-space"> </span><span class="python1-number">0</span><span class="python1-symbol">]

</span><span class="python1-comment"># Alinear longitud de las series
</span><span class="python1-identifier">min_len</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-nonreservedkeyword">min</span><span class="python1-symbol">(</span><span class="python1-nonreservedkeyword">len</span><span class="python1-symbol">(</span><span class="python1-identifier">series</span><span class="python1-symbol">)</span><span class="python1-space"> </span><span class="python1-reservedword">for</span><span class="python1-space"> </span><span class="python1-identifier">series</span><span class="python1-space"> </span><span class="python1-reservedword">in</span><span class="python1-space"> </span><span class="python1-identifier">data</span><span class="python1-symbol">.</span><span class="python1-identifier">values</span><span class="python1-symbol">())
</span><span class="python1-reservedword">for</span><span class="python1-space"> </span><span class="python1-identifier">t</span><span class="python1-space"> </span><span class="python1-reservedword">in</span><span class="python1-space"> </span><span class="python1-identifier">tickers</span><span class="python1-symbol">:
</span><span class="python1-space">    </span><span class="python1-identifier">data</span><span class="python1-symbol">[</span><span class="python1-identifier">t</span><span class="python1-symbol">]</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">data</span><span class="python1-symbol">[</span><span class="python1-identifier">t</span><span class="python1-symbol">].</span><span class="python1-identifier">iloc</span><span class="python1-symbol">[:</span><span class="python1-identifier">min_len</span><span class="python1-symbol">].</span><span class="python1-identifier">reset_index</span><span class="python1-symbol">(</span><span class="python1-identifier">drop</span><span class="python1-symbol">=</span><span class="python1-nonreservedkeyword">True</span><span class="python1-symbol">)

</span><span class="python1-comment"># Correlogramas y tests de estacionariedad
</span><span class="python1-reservedword">def</span><span class="python1-space"> </span><span class="python1-functionname">correlogram_tests</span><span class="python1-symbol">(</span><span class="python1-identifier">series</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">name</span><span class="python1-symbol">):
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;\nрџ“Љ Correlogramas para {name}&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">figure</span><span class="python1-symbol">(</span><span class="python1-identifier">figsize</span><span class="python1-symbol">=(</span><span class="python1-number">14</span><span class="python1-symbol">,</span><span class="python1-number">4</span><span class="python1-symbol">))
</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">subplot</span><span class="python1-symbol">(</span><span class="python1-number">1</span><span class="python1-symbol">,</span><span class="python1-number">2</span><span class="python1-symbol">,</span><span class="python1-number">1</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">plot_acf</span><span class="python1-symbol">(</span><span class="python1-identifier">series</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">ax</span><span class="python1-symbol">=</span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">gca</span><span class="python1-symbol">(),</span><span class="python1-space"> </span><span class="python1-identifier">lags</span><span class="python1-symbol">=</span><span class="python1-number">36</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">title</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;{name} - ACF&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">subplot</span><span class="python1-symbol">(</span><span class="python1-number">1</span><span class="python1-symbol">,</span><span class="python1-number">2</span><span class="python1-symbol">,</span><span class="python1-number">2</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">plot_pacf</span><span class="python1-symbol">(</span><span class="python1-identifier">series</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">ax</span><span class="python1-symbol">=</span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">gca</span><span class="python1-symbol">(),</span><span class="python1-space"> </span><span class="python1-identifier">lags</span><span class="python1-symbol">=</span><span class="python1-number">36</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">method</span><span class="python1-symbol">=</span><span class="python1-string">'ywm'</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">title</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;{name} - PACF&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">tight_layout</span><span class="python1-symbol">()
</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">show</span><span class="python1-symbol">()

</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;\nрџ”Ќ Prueba ADF para {name}&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">adf</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">adfuller</span><span class="python1-symbol">(</span><span class="python1-identifier">series</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;ADF Statistic: {adf[0]:.4f} | p-value: {adf[1]:.4f}&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;Critical Values: {adf[4]}&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-string">&quot;в†’ Estacionaria&quot;</span><span class="python1-space"> </span><span class="python1-reservedword">if</span><span class="python1-space"> </span><span class="python1-identifier">adf</span><span class="python1-symbol">[</span><span class="python1-number">1</span><span class="python1-symbol">]</span><span class="python1-space"> </span><span class="python1-symbol">&lt;</span><span class="python1-space"> </span><span class="python1-float">0.05</span><span class="python1-space"> </span><span class="python1-reservedword">else</span><span class="python1-space"> </span><span class="python1-string">&quot;в†’ No estacionaria&quot;</span><span class="python1-symbol">)

</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;\nрџ”Ќ Prueba KPSS para {name}&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">kpss_result</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">kpss</span><span class="python1-symbol">(</span><span class="python1-identifier">series</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">nlags</span><span class="python1-symbol">=</span><span class="python1-string">&quot;auto&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;KPSS Statistic: {kpss_result[0]:.4f} | p-value: {kpss_result[1]:.4f}&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;Critical Values: {kpss_result[3]}&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-string">&quot;в†’ Estacionaria&quot;</span><span class="python1-space"> </span><span class="python1-reservedword">if</span><span class="python1-space"> </span><span class="python1-identifier">kpss_result</span><span class="python1-symbol">[</span><span class="python1-number">1</span><span class="python1-symbol">]</span><span class="python1-space"> </span><span class="python1-symbol">&gt;=</span><span class="python1-space"> </span><span class="python1-float">0.05</span><span class="python1-space"> </span><span class="python1-reservedword">else</span><span class="python1-space"> </span><span class="python1-string">&quot;в†’ No estacionaria&quot;</span><span class="python1-symbol">)

</span><span class="python1-space">    </span><span class="python1-reservedword">if</span><span class="python1-space"> </span><span class="python1-identifier">adf</span><span class="python1-symbol">[</span><span class="python1-number">1</span><span class="python1-symbol">]</span><span class="python1-space"> </span><span class="python1-symbol">&gt;=</span><span class="python1-space"> </span><span class="python1-float">0.05</span><span class="python1-space"> </span><span class="python1-reservedword">and</span><span class="python1-space"> </span><span class="python1-identifier">kpss_result</span><span class="python1-symbol">[</span><span class="python1-number">1</span><span class="python1-symbol">]</span><span class="python1-space"> </span><span class="python1-symbol">&lt;</span><span class="python1-space"> </span><span class="python1-float">0.05</span><span class="python1-symbol">:
</span><span class="python1-space">        </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;\nрџЊЂ {name} parece seguir una caminata aleatoria.&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">else</span><span class="python1-symbol">:
</span><span class="python1-space">        </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;\nвњ”пёЏ {name} no parece una caminata aleatoria.&quot;</span><span class="python1-symbol">)

</span><span class="python1-comment"># Aplicar anГЎlisis a cada serie
</span><span class="python1-reservedword">for</span><span class="python1-space"> </span><span class="python1-identifier">ticker</span><span class="python1-space"> </span><span class="python1-reservedword">in</span><span class="python1-space"> </span><span class="python1-identifier">tickers</span><span class="python1-symbol">:
</span><span class="python1-space">    </span><span class="python1-identifier">correlogram_tests</span><span class="python1-symbol">(</span><span class="python1-identifier">data</span><span class="python1-symbol">[</span><span class="python1-identifier">ticker</span><span class="python1-symbol">],</span><span class="python1-space"> </span><span class="python1-identifier">ticker</span><span class="python1-symbol">)

</span><span class="python1-comment"># Test de cointegraciГіn Johansen entre pares
</span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-string">&quot;\nрџ’Ґ Test de CointegraciГіn de Johansen para pares:&quot;</span><span class="python1-symbol">)
</span><span class="python1-reservedword">for</span><span class="python1-space"> </span><span class="python1-identifier">pair</span><span class="python1-space"> </span><span class="python1-reservedword">in</span><span class="python1-space"> </span><span class="python1-identifier">combinations</span><span class="python1-symbol">(</span><span class="python1-identifier">tickers</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-number">2</span><span class="python1-symbol">):
</span><span class="python1-space">    </span><span class="python1-identifier">df_pair</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">pd</span><span class="python1-symbol">.</span><span class="python1-identifier">DataFrame</span><span class="python1-symbol">({</span><span class="python1-identifier">pair</span><span class="python1-symbol">[</span><span class="python1-number">0</span><span class="python1-symbol">]:</span><span class="python1-space"> </span><span class="python1-identifier">data</span><span class="python1-symbol">[</span><span class="python1-identifier">pair</span><span class="python1-symbol">[</span><span class="python1-number">0</span><span class="python1-symbol">]],</span><span class="python1-space"> </span><span class="python1-identifier">pair</span><span class="python1-symbol">[</span><span class="python1-number">1</span><span class="python1-symbol">]:</span><span class="python1-space"> </span><span class="python1-identifier">data</span><span class="python1-symbol">[</span><span class="python1-identifier">pair</span><span class="python1-symbol">[</span><span class="python1-number">1</span><span class="python1-symbol">]]})
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;\n{pair[0]} vs {pair[1]}&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">result</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">coint_johansen</span><span class="python1-symbol">(</span><span class="python1-identifier">df_pair</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">det_order</span><span class="python1-symbol">=</span><span class="python1-number">0</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">k_ar_diff</span><span class="python1-symbol">=</span><span class="python1-number">1</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;Trace Stats: {result.lr1}&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;Critical values (95%): {result.cvt[:,1]}&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">if</span><span class="python1-space"> </span><span class="python1-identifier">result</span><span class="python1-symbol">.</span><span class="python1-identifier">lr1</span><span class="python1-symbol">[</span><span class="python1-number">0</span><span class="python1-symbol">]</span><span class="python1-space"> </span><span class="python1-symbol">&gt;</span><span class="python1-space"> </span><span class="python1-identifier">result</span><span class="python1-symbol">.</span><span class="python1-identifier">cvt</span><span class="python1-symbol">[</span><span class="python1-number">0</span><span class="python1-symbol">,</span><span class="python1-number">1</span><span class="python1-symbol">]:
</span><span class="python1-space">        </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-string">&quot;вњ… CointegraciГіn detectada&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">else</span><span class="python1-symbol">:
</span><span class="python1-space">        </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-string">&quot;вќЊ No hay cointegraciГіn significativa&quot;</span><span class="python1-symbol">)

</span><span class="python1-comment"># ARIMA + PronГіstico
</span><span class="python1-reservedword">def</span><span class="python1-space"> </span><span class="python1-functionname">best_arima</span><span class="python1-symbol">(</span><span class="python1-identifier">series</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">name</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">steps</span><span class="python1-symbol">=</span><span class="python1-number">30</span><span class="python1-symbol">):
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;\nрџ“€ Buscando mejor ARIMA para {name}&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">best_aic</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-nonreservedkeyword">float</span><span class="python1-symbol">(</span><span class="python1-string">'inf'</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">best_order</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-nonreservedkeyword">None
</span><span class="python1-space">    </span><span class="python1-reservedword">for</span><span class="python1-space"> </span><span class="python1-identifier">p</span><span class="python1-space"> </span><span class="python1-reservedword">in</span><span class="python1-space"> </span><span class="python1-nonreservedkeyword">range</span><span class="python1-symbol">(</span><span class="python1-number">4</span><span class="python1-symbol">):
</span><span class="python1-space">        </span><span class="python1-reservedword">for</span><span class="python1-space"> </span><span class="python1-identifier">d</span><span class="python1-space"> </span><span class="python1-reservedword">in</span><span class="python1-space"> </span><span class="python1-nonreservedkeyword">range</span><span class="python1-symbol">(</span><span class="python1-number">3</span><span class="python1-symbol">):
</span><span class="python1-space">            </span><span class="python1-reservedword">for</span><span class="python1-space"> </span><span class="python1-identifier">q</span><span class="python1-space"> </span><span class="python1-reservedword">in</span><span class="python1-space"> </span><span class="python1-nonreservedkeyword">range</span><span class="python1-symbol">(</span><span class="python1-number">4</span><span class="python1-symbol">):
</span><span class="python1-space">                </span><span class="python1-reservedword">try</span><span class="python1-symbol">:
</span><span class="python1-space">                    </span><span class="python1-identifier">model</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">ARIMA</span><span class="python1-symbol">(</span><span class="python1-identifier">series</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">order</span><span class="python1-symbol">=(</span><span class="python1-identifier">p</span><span class="python1-symbol">,</span><span class="python1-identifier">d</span><span class="python1-symbol">,</span><span class="python1-identifier">q</span><span class="python1-symbol">)).</span><span class="python1-identifier">fit</span><span class="python1-symbol">()
</span><span class="python1-space">                    </span><span class="python1-reservedword">if</span><span class="python1-space"> </span><span class="python1-identifier">model</span><span class="python1-symbol">.</span><span class="python1-identifier">aic</span><span class="python1-space"> </span><span class="python1-symbol">&lt;</span><span class="python1-space"> </span><span class="python1-identifier">best_aic</span><span class="python1-symbol">:
</span><span class="python1-space">                        </span><span class="python1-identifier">best_aic</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">model</span><span class="python1-symbol">.</span><span class="python1-identifier">aic
</span><span class="python1-space">                        </span><span class="python1-identifier">best_order</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-symbol">(</span><span class="python1-identifier">p</span><span class="python1-symbol">,</span><span class="python1-identifier">d</span><span class="python1-symbol">,</span><span class="python1-identifier">q</span><span class="python1-symbol">)
</span><span class="python1-space">                </span><span class="python1-reservedword">except</span><span class="python1-symbol">:
</span><span class="python1-space">                    </span><span class="python1-reservedword">continue
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;рџЏ† Mejor ARIMA({best_order}) con AIC={best_aic:.2f}&quot;</span><span class="python1-symbol">)

</span><span class="python1-space">    </span><span class="python1-identifier">final_model</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">ARIMA</span><span class="python1-symbol">(</span><span class="python1-identifier">series</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">order</span><span class="python1-symbol">=</span><span class="python1-identifier">best_order</span><span class="python1-symbol">).</span><span class="python1-identifier">fit</span><span class="python1-symbol">()
</span><span class="python1-space">    </span><span class="python1-identifier">forecast</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">final_model</span><span class="python1-symbol">.</span><span class="python1-identifier">get_forecast</span><span class="python1-symbol">(</span><span class="python1-identifier">steps</span><span class="python1-symbol">=</span><span class="python1-identifier">steps</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">pred</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">forecast</span><span class="python1-symbol">.</span><span class="python1-identifier">predicted_mean
</span><span class="python1-space">    </span><span class="python1-identifier">ci</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">forecast</span><span class="python1-symbol">.</span><span class="python1-identifier">conf_int</span><span class="python1-symbol">()

</span><span class="python1-space">    </span><span class="python1-identifier">forecast_index</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-nonreservedkeyword">range</span><span class="python1-symbol">(</span><span class="python1-nonreservedkeyword">len</span><span class="python1-symbol">(</span><span class="python1-identifier">series</span><span class="python1-symbol">),</span><span class="python1-space"> </span><span class="python1-nonreservedkeyword">len</span><span class="python1-symbol">(</span><span class="python1-identifier">series</span><span class="python1-symbol">)</span><span class="python1-space"> </span><span class="python1-symbol">+</span><span class="python1-space"> </span><span class="python1-identifier">steps</span><span class="python1-symbol">)

</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">figure</span><span class="python1-symbol">(</span><span class="python1-identifier">figsize</span><span class="python1-symbol">=(</span><span class="python1-number">12</span><span class="python1-symbol">,</span><span class="python1-number">6</span><span class="python1-symbol">))
</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">plot</span><span class="python1-symbol">(</span><span class="python1-identifier">series</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">label</span><span class="python1-symbol">=</span><span class="python1-identifier">f</span><span class="python1-string">&quot;{name} histГіrico&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">plot</span><span class="python1-symbol">(</span><span class="python1-identifier">forecast_index</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">pred</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">label</span><span class="python1-symbol">=</span><span class="python1-string">'PronГіstico'</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">color</span><span class="python1-symbol">=</span><span class="python1-string">'red'</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">fill_between</span><span class="python1-symbol">(</span><span class="python1-identifier">forecast_index</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">ci</span><span class="python1-symbol">.</span><span class="python1-identifier">iloc</span><span class="python1-symbol">[:,</span><span class="python1-number">0</span><span class="python1-symbol">],</span><span class="python1-space"> </span><span class="python1-identifier">ci</span><span class="python1-symbol">.</span><span class="python1-identifier">iloc</span><span class="python1-symbol">[:,</span><span class="python1-number">1</span><span class="python1-symbol">],</span><span class="python1-space"> </span><span class="python1-identifier">alpha</span><span class="python1-symbol">=</span><span class="python1-float">0.3</span><span class="python1-symbol">,</span><span class="python1-space"> </span><span class="python1-identifier">color</span><span class="python1-symbol">=</span><span class="python1-string">'pink'</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">title</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;{name} - PronГіstico 30 dГ­as&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">legend</span><span class="python1-symbol">()
</span><span class="python1-space">    </span><span class="python1-identifier">plt</span><span class="python1-symbol">.</span><span class="python1-identifier">show</span><span class="python1-symbol">()

</span><span class="python1-space">    </span><span class="python1-identifier">last</span><span class="python1-space"> </span><span class="python1-symbol">=</span><span class="python1-space"> </span><span class="python1-identifier">series</span><span class="python1-symbol">.</span><span class="python1-identifier">iloc</span><span class="python1-symbol">[-</span><span class="python1-number">1</span><span class="python1-symbol">]
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;Гљltimo valor observado: {last:.2f}&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;Media del pronГіstico: {pred.mean():.2f}&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">if</span><span class="python1-space"> </span><span class="python1-identifier">pred</span><span class="python1-symbol">.</span><span class="python1-identifier">mean</span><span class="python1-symbol">()</span><span class="python1-space"> </span><span class="python1-symbol">&gt;</span><span class="python1-space"> </span><span class="python1-identifier">last</span><span class="python1-symbol">:
</span><span class="python1-space">        </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-string">&quot;Tendencia esperada: в¬†пёЏ Al alza&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">elif</span><span class="python1-space"> </span><span class="python1-identifier">pred</span><span class="python1-symbol">.</span><span class="python1-identifier">mean</span><span class="python1-symbol">()</span><span class="python1-space"> </span><span class="python1-symbol">&lt;</span><span class="python1-space"> </span><span class="python1-identifier">last</span><span class="python1-symbol">:
</span><span class="python1-space">        </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-string">&quot;Tendencia esperada: в¬‡пёЏ A la baja&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">else</span><span class="python1-symbol">:
</span><span class="python1-space">        </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-string">&quot;Tendencia esperada: вћЎпёЏ Estable&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;Intervalo al final: [{ci.iloc[-1,0]:.2f}, {ci.iloc[-1,1]:.2f}]&quot;</span><span class="python1-symbol">)
</span><span class="python1-space">    </span><span class="python1-reservedword">print</span><span class="python1-symbol">(</span><span class="python1-identifier">f</span><span class="python1-string">&quot;Primeros 5 valores:\n{pred[:5]}&quot;</span><span class="python1-symbol">)

</span><span class="python1-comment"># Ejecutar ARIMA y forecast
</span><span class="python1-reservedword">for</span><span class="python1-space"> </span><span class="python1-identifier">ticker</span><span class="python1-space"> </span><span class="python1-reservedword">in</span><span class="python1-space"> </span><span class="python1-identifier">tickers</span><span class="python1-symbol">:
</span><span class="python1-space">    </span><span class="python1-identifier">best_arima</span><span class="python1-symbol">(</span><span class="python1-identifier">data</span><span class="python1-symbol">[</span><span class="python1-identifier">ticker</span><span class="python1-symbol">],</span><span class="python1-space"> </span><span class="python1-identifier">ticker</span><span class="python1-symbol">)
</span></code></pre><!--EndFragment--></body>
</html>